import Point from "../../quickdrawJS/geometry/point"
import * as LocalStore from "../../quickdrawJS/storage/localStore"
import PolyTile from "../../quickdrawJS/geometry/interactive/polygonTile"

export default class GridStorage{

	public static SquareGrid:any = JSON.parse(`{"polygons":[[{"x":60,"y":0},{"x":0.00007960769380065197,"y":59.99999999994719},{"x":-59.999999999788756,"y":0.0001592153876011638},{"x":-0.00023882308142804073,"y":-59.9999999995247}],[{"x":0.00011941154071593019,"y":59.99999999988118},{"x":-59.99964176516662,"y":120.00015921479348},{"x":-119.99988058740306,"y":60.000477646043976},{"x":-60.00027862671706,"y":0.00015921658906847824}],[{"x":0.00011941142189617307,"y":59.99996019603427},{"x":60.000358233658325,"y":119.99964176478375},{"x":0.0007562729722952793,"y":179.99996019423867},{"x":-59.99964176359548,"y":120.00043784172178}],[{"x":59.99999999998681,"y":-0.000039803846902941586},{"x":120.00007960746936,"y":59.99980098071268},{"x":60.000318430762,"y":119.999960195625},{"x":0.00007960852558142051,"y":60.00027862687551}]],"bounds":{"x":-42.426603890062104,"y":-127.27972723240211,"width":169.70607781294035,"height":169.7063029766793},"normalized_clipRect":{"x":0,"y":0,"width":1,"height":1.000001326786535},"normalized_polygons":[[{"x":0.000001160941739542586,"y":0.5000016584835544},{"x":0.49999950245510455,"y":0.5000013267859298},{"x":0.500000497547977,"y":0.9999996682984145},{"x":0.0000021560372527748808,"y":1.000001326786535}],[{"x":0.4999993366059075,"y":0.5000011609372829},{"x":0.9999976781166318,"y":0.49999950244916225},{"x":1,"y":0.9999978439572462},{"x":0.5000016584954371,"y":1.0000008292358624}],[{"x":0.4999991707574805,"y":0.5000013267866998},{"x":0.49999684887411205,"y":0.0000029852786161102434},{"x":0.9999951903786753,"y":0},{"x":0.9999988390525393,"y":0.49999834150016204}],[{"x":9.950928725112634e-7,"y":0.5000018243325314},{"x":0,"y":0.000003482820046631316},{"x":0.4999983415107244,"y":0.0000018243319262258133},{"x":0.5000006633940928,"y":0.50000016584001}]]}`);
	public static TriGrid:any = JSON.parse(`{"polygons":[[{"x":60,"y":0},{"x":-29.999908076906156,"y":51.96157729878088},{"x":-30.000183845906026,"y":-51.96141808314934}],[{"x":-30.000229807464677,"y":-51.9613915471498},{"x":59.999678268596526,"y":-103.92328727670588},{"x":60.00022980744121,"y":-0.00013268060767757106}],[{"x":59.99999999997653,"y":-0.000053071795875325734},{"x":60.00027576897639,"y":103.92294231013435},{"x":-29.999908076084647,"y":51.96184265776025}],[{"x":59.999632306873586,"y":-103.92331381242089},{"x":150.00009192008946,"y":-51.96237337714181},{"x":60.00045961640808,"y":-2.6425439614286006e-9}],[{"x":150.0000919196435,"y":-51.962426449018984},{"x":150.00119499733285,"y":51.96072814268854},{"x":60.00045961934205,"y":0.00026535674334692276}],[{"x":150.00124095860986,"y":51.96070160620112},{"x":60.0018844298432,"y":103.92355262417999},{"x":60.00022981330917,"y":0.000398039790283633}]],"bounds":{"x":-30.000183845906026,"y":-51.96237337714181,"width":180.00137884323888,"height":103.9239506759227},"normalized_clipRect":{"x":0,"y":0,"width":1,"height":0.5773508588866358},"normalized_polygons":[[{"x":0.49999719126755215,"y":0.2886776407551591},{"x":0.0000015320382634980576,"y":0.5773508588866358},{"x":0,"y":0.0000053071481930191635}],[{"x":-2.553400365419927e-7,"y":0.00000545456928339469},{"x":0.49999540388455793,"y":-0.28866953260850425},{"x":0.49999846796577907,"y":0.28867690364631843}],[{"x":0.49999719126742176,"y":0.2886773459141072},{"x":0.4999987233056852,"y":0.86602289765255},{"x":0.0000015320428273975127,"y":0.5773523330918952}],[{"x":0.4999951485436087,"y":-0.2886696800280139},{"x":0.9999938718400355,"y":0},{"x":0.49999974467248176,"y":0.2886776407404784}],[{"x":0.999993871837558,"y":-2.94841503530066e-7},{"x":1,"y":0.5773461413889266},{"x":0.4999997446887815,"y":0.28867911494799614}],[{"x":1.000000255338472,"y":0.5773459939651259},{"x":0.5000076602420417,"y":0.866026288260164},{"x":0.4999984679983786,"y":0.28867985207038815}]]}`);
	public static HexGrid:any = JSON.parse(`{"polygons":[[{"x":60,"y":0},{"x":30.000045961511717,"y":51.961497691148054},{"x":-29.999908076906156,"y":51.96157729878088},{"x":-59.999999999788756,"y":0.0001592153876011638},{"x":-30.000183845906026,"y":-51.96141808314934},{"x":29.999770192089347,"y":-51.96165690604782}],[{"x":29.999747211195597,"y":-51.961670174012035},{"x":59.99970124883892,"y":-103.92348629593533},{"x":119.99993105583415,"y":-103.92372511993146},{"x":150.0002987485616,"y":-51.9621478223702},{"x":120.00048259636883,"y":-0.00025209305803031157},{"x":60.00025279021858,"y":0.00014594693554670357}],[{"x":-30.00020682661789,"y":-51.961404815113966},{"x":-60.00043663368355,"y":-103.92274329038656},{"x":-30.0007583646176,"y":-155.8844001959465},{"x":29.999195672532775,"y":-155.88479823411063},{"x":59.99956336357024,"y":-103.92353936732464},{"x":30.000022979532368,"y":-51.961802855107564}],[{"x":-59.99999999971248,"y":0.00018575128555653464},{"x":-119.99995403770787,"y":0.00042457418402364056},{"x":-150.00018384477352,"y":-51.96091390108856},{"x":-120.00050557570755,"y":-103.92257080664852},{"x":-60.000551538557175,"y":-103.92296884481263},{"x":-30.000183847519715,"y":-51.961709978026626}],[{"x":-59.999977019000625,"y":0.00017248325018215382},{"x":-29.99974721193496,"y":51.961510958522794},{"x":-59.9994254810009,"y":103.92316786408276},{"x":-119.9993795181513,"y":103.92356590224686},{"x":-149.99974720918877,"y":51.96230703546084},{"x":-120.00020682515088,"y":0.0005705232437520635}],[{"x":-29.999747212081658,"y":51.96148442262486},{"x":30.000206825068748,"y":51.96108638446075},{"x":60.000574516106205,"y":103.92234525124677},{"x":30.001034132068295,"y":155.88408176346385},{"x":-29.998919903814613,"y":155.88463901689363},{"x":-59.99942547861264,"y":103.92345975896005}],[{"x":120.00050557715109,"y":-0.0002653612153480367},{"x":150.00101115448408,"y":51.96123232749344},{"x":120.00133288795311,"y":103.9232076638286},{"x":60.00110308307033,"y":103.9237649198196},{"x":30.000459621343055,"y":51.962346840329175},{"x":60.00000000200096,"y":0.00029189733690060393}]],"bounds":{"x":-90.00022980732972,"y":-51.96185592639524,"width":180.0009651949968,"height":103.92373838752977},"normalized_clipRect":{"x":0,"y":0,"width":1,"height":0.577351006284595},"normalized_polygons":[[{"x":0.83333014156248,"y":0.28867542943508356},{"x":0.6666646239304548,"y":0.5773488686850212},{"x":0.33333333332643317,"y":0.5773493109472766},{"x":0.16666704967410267,"y":0.2886763139602717},{"x":0.333331801284649,"y":0.0000024324494339431765},{"x":0.6666630918863234,"y":0.0000011056626679800189}],[{"x":0.6666629642153761,"y":0.0000010319521509327767},{"x":0.833328481842707,"y":-0.2886741763481632},{"x":1.1666613044861656,"y":-0.2886755031410272},{"x":1.3333291201849746,"y":-0.0000016216356098118472},{"x":1.166664368583817,"y":0.28867402892560434},{"x":0.8333315459450525,"y":0.28867624024704447}],[{"x":0.3333316736147121,"y":0.0000025061603463263823},{"x":0.16666462394324996,"y":-0.2886700485616929},{"x":0.33332860953114396,"y":-0.5773443723313981},{"x":0.666659900128124,"y":-0.5773465836426747},{"x":0.8333277158175441,"y":-0.2886744711876339},{"x":0.6666644962534765,"y":2.948389060933767e-7}],[{"x":0.16666704967452645,"y":0.2886764613811365},{"x":-0.1666642409271481,"y":0.2886777881679024},{"x":-0.33333129059861016,"y":0.000005233445863233886},{"x":-0.16666730501071614,"y":-0.2886690903238421},{"x":0.1666639855862639,"y":-0.2886713016351185},{"x":0.33333180127568407,"y":8.108199222921851e-7}],[{"x":0.16666717734446326,"y":0.28867638767022413},{"x":0.3333342270159254,"y":0.5773489423922635},{"x":0.16667024142803152,"y":0.8660232661619687},{"x":-0.1666610491689487,"y":0.8660254774732452},{"x":-0.3333288648583689,"y":0.5773533650182042},{"x":-0.16666564529430106,"y":0.2886785989916642}],[{"x":0.33333422701511045,"y":0.5773487949713988},{"x":0.6666655176120907,"y":0.5773465836601223},{"x":0.8333333333015107,"y":0.8660186961151632},{"x":0.6666701137374429,"y":1.1546934621417033},{"x":0.33333882314750424,"y":1.1546965579774904},{"x":0.16667024144129955,"y":0.8660248877914805}],[{"x":1.1666644962541448,"y":0.2886739552140145},{"x":1.3333330779744323,"y":0.5773473944504007},{"x":1.1666690924006216,"y":0.8660234872704823},{"x":0.833336269768899,"y":0.8660265831204984},{"x":0.666666922028306,"y":0.577353586155176},{"x":0.8333301415735963,"y":0.2886770510782597}]]}`);

	public static defaultGrids:any = [GridStorage.SquareGrid, GridStorage.TriGrid, GridStorage.HexGrid];

	public static createDefaultGridSelectors(parentElementID:string, callbackObject:any):void{
		
		let parentElement = document.getElementById(parentElementID);

		for (var i = 0; i < GridStorage.defaultGrids.length; ++i) {
			
			let grid = GridStorage.defaultGrids[i];
			let w = parentElement.clientWidth;
			let tile:PolyTile = new PolyTile(new Point(0,0), new Point(w/4,w/4), grid);
			tile.redraw();

			var canvas = document.createElement("canvas");
			canvas.width = w/2-20;
			canvas.height = w/2-20;
			var ctx = canvas.getContext("2d");
			tile.patternRect(ctx, new Point(0,0), new Point(canvas.width, canvas.height));

			var url = canvas.toDataURL();
			var img:HTMLImageElement = document.createElement("img") as HTMLImageElement;
			img.setAttribute("src",url);

			parentElement.appendChild(img);

			img.addEventListener("click", ()=>{
				callbackObject.setGrid(grid);
			})

		}
	}

	public static createCustomGridSelectors(parentElementID:string, callbackObject:any):void{
		
		if(LocalStore.contains("customGrids")){
			let grids = JSON.parse(LocalStore.get("customGrids"));
			let parentElement = document.getElementById(parentElementID);
			for (var i = 0; i < grids.length; ++i) {
				
				let grid = grids[i];
				let w = parentElement.clientWidth;
				let tile:PolyTile = new PolyTile(new Point(0,0), new Point(w/4,w/4), grid);
				tile.redraw();

				var canvas = document.createElement("canvas");
				canvas.width = w/2-20;
				canvas.height = w/2-20;
				var ctx = canvas.getContext("2d");
				tile.patternRect(ctx, new Point(0,0), new Point(canvas.width, canvas.height));

				var url = canvas.toDataURL();
				var img:HTMLImageElement = document.createElement("img") as HTMLImageElement;
				img.setAttribute("src",url);

				parentElement.appendChild(img);

				img.addEventListener("click", ()=>{
					callbackObject.setGrid(grid);
				})

			}
		}
	}

}


